{% extends "layouts/base.html" %}
{% from "includes/_form_helpers.html" import render_field_with_label, render_field %}

{% block title %} Detalles test {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}
{% endblock stylesheets %}

{% if test["fall_to_left"] is not none %}
{% set probabilidad_caida = test["fall_to_left"] + test["fall_to_right"] + test["falling_backward"] + test["falling_forward"] %}
{% endif %}

{% block content %}

    <div class="pcoded-content">
        <div class="pcoded-inner-content">
            <!-- [ breadcrumb ] start -->

            <!-- [ breadcrumb ] end -->
            <div class="main-body">
                <div class="page-wrapper">
                    <div class="card Recent-Users">
                        <div class="card-header">
                            <h5>Detalles test</h5>
                        </div>
                        <div class="card-block px-0 py-3">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <tbody>
                                        <tr class="unread">
                                            <td>
                                                <h6 class="text-muted">NÃºmero de test</h6>
                                            </td>
                                            <td>
                                                <h6 class="text-muted">{{test["num_test"]}}</h6>
                                            </td>
                                        </tr> 
                                        <tr class="unread">
                                            <td>
                                                <h6 class="text-muted">Fecha</h6>
                                            </td>
                                            <td>
                                                <h6 class="text-muted">{{test["date"]}}</h6>
                                            </td>
                                        </tr>
                                        {% if test["diagnostico"] is not none and not editing %}
                                        <tr class="unread">
                                            <td>
                                                <h6 class="text-muted">Diagnostico</h6>
                                            </td>
                                            <td>
                                                {{test.diagnostico|safe}}
                                            </td>
                                        </tr>
                                        {% endif %}
                                        {% if probabilidad_caida is not none %}
                                        <tr class="unread">
                                            <td>
                                                <h6 class="text-muted">Probabilidad de caida</h6>
                                            </td>
                                            <td>
                                                <h6 class="text-muted">{{probabilidad_caida}}</h6>
                                            </td>
                                        </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    {% if test["diagnostico"] is none %}
                    <div class="card Recent-Users">
                        <div class="card-header">
                            <h5>Diagnosticar test</h5>
                        </div>
                        <form role="form" method="post" action="">
                            {{ form.csrf_token }}
                            {{form.diagnostico()}}
                            {{form.submitDiagnosticoTest(class="label theme-bg text-white f-12 btn-rounded")}}
                        </form>
                        {{ ckeditor.load() }}
                        {{ ckeditor.config(name='diagnostico') }}
                    </div>
                    {% elif editing %}
                    <div class="card Recent-Users">
                        <div class="card-header">
                            <h5>Editar diagnostico</h5>
                        </div>
                        <form role="form" method="post" action="">
                            {{ form.csrf_token }}
                            {{form.diagnostico()}}
                            {{form.submitDiagnosticoTest(class="label theme-bg text-white f-12 btn-rounded")}}
                        </form>
                        {{ ckeditor.load() }}
                        {{ ckeditor.config(name='diagnostico') }}
                    </div>
                    <a href="{{url_for('prefall_blueprint.detalles_test', id=test['id_paciente'], num=test['num_test'], editing=False)}}" class="label theme-bg text-white f-12 btn-rounded">Cancelar</a>
                    {% else %}
                    <a href="{{url_for('prefall_blueprint.detalles_test', id=test['id_paciente'], num=test['num_test'], editing=True)}}" class="label theme-bg text-white f-12 btn-rounded">Editar</a>
                    {% endif %}
                    <a href="{{url_for('prefall_blueprint.get_test', paciente=test['id_paciente'], test=test['num_test'])}}" class="label theme-bg text-white f-12 btn-rounded">Descargar</a>
                    {% if test["probabilidad_caida"] is none %}
                    <button id="analize-btn" class="label theme-bg text-white f-12 btn-rounded" onclick="start_prediction();">Analizar</button>
                    {% endif %}
                    <br>
                    <br>
                    <div id="svm" class="img-fluid" width="100%" height="100%"></div>
                    <div class="control-stream">
                        <button id="play_svm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16">
                                <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>
                            </svg>
                        </button>
                        <button id="stop_svm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop" viewBox="0 0 16 16">
                                <path d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>
                            </svg>
                        </button>
                        <button id="pause_svm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16">
                                <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="acc" class="img-fluid" width="100%" height="100%"></div>
                    <div id="gyr" class="img-fluid" width="100%" height="100%"></div>
                    <div id="mag" class="img-fluid" width="100%" height="100%"></div>
                    <div id="acc_stream" class="img-fluid" width="100%" height="100%"></div>
                    <div class="control-stream">
                        <button id="play_acc">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16">
                                <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>
                            </svg>
                        </button>
                        <button id="stop_acc">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop" viewBox="0 0 16 16">
                                <path d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>
                            </svg>
                        </button>
                        <button id="pause_acc">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16">
                                <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="gyr_stream" class="img-fluid" width="100%" height="100%"></div>
                    <div class="control-stream">
                        <button id="play_gyr">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16">
                                <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>
                            </svg>
                        </button>
                        <button id="stop_gyr">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop" viewBox="0 0 16 16">
                                <path d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>
                            </svg>
                        </button>
                        <button id="pause_gyr">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16">
                                <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="mag_stream" class="img-fluid" width="100%" height="100%"></div>
                    <div class="control-stream">
                        <button id="play_mag">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-play" viewBox="0 0 16 16">
                                <path d="M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z"/>
                            </svg>
                        </button>
                        <button id="stop_mag">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stop" viewBox="0 0 16 16">
                                <path d="M3.5 5A1.5 1.5 0 0 1 5 3.5h6A1.5 1.5 0 0 1 12.5 5v6a1.5 1.5 0 0 1-1.5 1.5H5A1.5 1.5 0 0 1 3.5 11V5zM5 4.5a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 .5.5h6a.5.5 0 0 0 .5-.5V5a.5.5 0 0 0-.5-.5H5z"/>
                            </svg>
                        </button>
                        <button id="pause_mag">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pause" viewBox="0 0 16 16">
                                <path d="M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z"/>
                            </svg>
                        </button>
                    </div>
                    <div id="3d_plot" class="img-fluid" width="100%" height="100%"></div>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.5.0/d3.js"></script>
                    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
                    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
                    <script src="/static/assets/js/plot.js" paciente={{test["id_paciente"]}} num_test={{test["num_test"]}}></script>
                    <script src="/static/assets/js/predict.js" paciente={{test["id_paciente"]}} num_test={{test["num_test"]}}></script>
                    <script src="/static/assets/js/plot-svm.js" paciente={{test["id_paciente"]}} num_test={{test["num_test"]}} analizado={{probabilidad_caida is not none}}></script>
                </div>
            </div>
        </div>
    </div>

{% endblock %}